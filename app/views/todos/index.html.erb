<h1>Todo Dashboard</h1>

<div class="container">
	<!-- Want user to be able to update this.  -->
	<h3>Category</h3> 

	<input type="text" class="form-control"> <br/>
	<button class= "btn btn-info">Add Todo</button>

	<ul>
		<%@todos.each do |todo| %>

		<li data-todo-id="<%= todo.id %>">  
			<input type="checkbox" <%if todo.completed%>checked<%end%>>
			<%=todo.description%> 
			<span>&times;</span>
		</li>
		
		<% end %>
	</ul>
</div>


<%= link_to 'Logout' , sessions_path, method: :delete %><br />
Logged in as <%= current_user.email %>

<script type ="text/javascript">
$('button').click(function(){
	var desc = $('input').val();

	data_hash = {
		"todo":{"description": desc}
	}

	var request = $.ajax({
		url: "/todos",
		type: "POST",
		data: data_hash,
		dataType: "json"
	});

	request.done(function(data){
		$('ul').append("<li data-todo-id= '" + data.id + "'>" + "<input type ='checkbox'> " + data.description + "<span>&times;</span></li>")
		//console.log(data);
		$('input').val() = "";
	});

	request.fail(function(data){
		console.log("FAIL FUNCTION");
		$('h1').append("<p> There was an error saving your todo</p>")
	});

});


$('ul').click(function(e){
  	console.log(e.target);
  	var li = $(e.target).parent();
	var id = li.data("todo-id");

  	if($(e.target).is("span")){
		var request = $.ajax({
			url: "/todos/"+id,
			type: "DELETE",
			dataType: "json"
		});

		request.done(function(data){
			li.remove();
		});
	}

	if($(e.target).is("input")){
		var checkbox_value = $(e.target).is(':checked');
		
		data_hash = {
		"todo":{"completed":checkbox_value}
		}

		var request = $.ajax({
			url: "/todos/"+ id,
			type: "PATCH",
			data: data_hash,
			dataType: "json"
		});

		request.done(function(data){
			console.log(data)

		});
	}

});


</script>
